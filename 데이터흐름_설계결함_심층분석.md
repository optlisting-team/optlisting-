# OptListing ë°ì´í„° íë¦„ ë° ì„¤ê³„ ê²°í•¨ ì‹¬ì¸µ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“‹ ë¶„ì„ ê°œìš”
í”„ë¡œì íŠ¸ì˜ ë°ì´í„° íë¦„ê³¼ ì„¤ê³„ì  ê²°í•¨ì„ 5ê°€ì§€ í•µì‹¬ ì§ˆë¬¸ì„ í†µí•´ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.

---

## 1. ğŸ“Š ë°ì´í„° íŒŒì´í”„ë¼ì¸ ë¶„ì„ (eBay -> DB)

### 1.1 GetMyeBaySelling ì‘ë‹µ ë°ì´í„° ë§¤í•‘ ìœ„ì¹˜

**íŒŒì¼ ê²½ë¡œ**: `backend/ebay_webhook.py`

**í•¨ìˆ˜**: `get_active_listings_trading_api_internal()` (ë¼ì¸ 2027-2425)

#### XML íŒŒì‹± ë° ë§¤í•‘ íë¦„

**Step 1: XML ì‘ë‹µ íŒŒì‹±** (ë¼ì¸ 2118-2150)
```2121:2150:backend/ebay_webhook.py
        # XML íŒŒì‹±
        t3 = datetime.utcnow()
        import xml.etree.ElementTree as ET
        root = ET.fromstring(response.text)
        t3_duration = (datetime.utcnow() - t3).total_seconds() * 1000
        logger.info(f"ğŸ“Š [t3] XML parsed [RequestId: {request_id}] - Duration: {t3_duration:.2f}ms")
        
        # ë””ë²„ê¹…: ì²« ë²ˆì§¸ Itemì˜ XML êµ¬ì¡° í™•ì¸ (ì´ë¯¸ì§€ ê´€ë ¨)
        first_item = root.find(".//{urn:ebay:apis:eBLBaseComponents}Item")
        ...
        # ì—ëŸ¬ ì²´í¬
        ack = root.find(".//ebay:Ack", ns)
        if ack is not None and ack.text != "Success":
            errors = root.findall(".//ebay:Errors/ebay:ShortMessage", ns)
            error_msg = errors[0].text if errors else "Unknown error"
            logger.error(f"âŒ eBay API Error: {error_msg}")
            raise HTTPException(status_code=400, detail=f"eBay Error: {error_msg}")
```

**Step 2: Itemë³„ ë°ì´í„° ì¶”ì¶œ** (ë¼ì¸ 2152-2303)
```2159:2292:backend/ebay_webhook.py
            for item in items:
                # ê¸°ë³¸ ì •ë³´
                item_id = item.findtext("ebay:ItemID", "", ns)
                title = item.findtext("ebay:Title", "", ns)
                
                # ê°€ê²©
                current_price = item.find("ebay:SellingStatus/ebay:CurrentPrice", ns)
                price = float(current_price.text) if current_price is not None and current_price.text else 0
                
                # ìˆ˜ëŸ‰
                quantity = int(item.findtext("ebay:QuantityAvailable", "0", ns))
                quantity_sold = int(item.findtext("ebay:SellingStatus/ebay:QuantitySold", "0", ns))
                
                # í†µê³„
                watch_count = int(item.findtext("ebay:WatchCount", "0", ns))
                hit_count = int(item.findtext("ebay:HitCount", "0", ns))  # ì¡°íšŒìˆ˜
                
                # ë‚ ì§œ
                start_time = item.findtext("ebay:ListingDetails/ebay:StartTime", "", ns)
                
                # SKU
                sku = item.findtext("ebay:SKU", "", ns)
                
                # ì´ë¯¸ì§€ ì¶”ì¶œ (ë¼ì¸ 2183-2260) ...
                
                # Supplier ì •ë³´ ì¶”ì¶œ (SKU, ì´ë¯¸ì§€ URL, ì œëª© ê¸°ë°˜)
                from .services import extract_supplier_info
                supplier_name, supplier_id = extract_supplier_info(
                    sku=sku,
                    image_url=picture_url or thumbnail_url,
                    title=title,
                    brand="",  # Trading APIì—ì„œ brand ì •ë³´ëŠ” ë³„ë„ë¡œ ê°€ì ¸ì™€ì•¼ í•¨
                    upc=""  # Trading APIì—ì„œ UPC ì •ë³´ëŠ” ë³„ë„ë¡œ ê°€ì ¸ì™€ì•¼ í•¨
                )
                
                listing = {
                    "item_id": item_id,
                    "ebay_item_id": item_id,
                    "sell_item_id": item_id,  # Sell Item ID ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€
                    "title": title,
                    "price": price,
                    "quantity_available": quantity,
                    "quantity_sold": quantity_sold,
                    "watch_count": watch_count,
                    "view_count": hit_count,
                    "impressions": 0,  # Trading APIì—ì„œëŠ” ì œê³µ ì•ˆ ë¨, Analytics API í•„ìš”
                    "sku": sku,
                    ...
                    "supplier_name": supplier_name,  # ì¶”ì¶œëœ ê³µê¸‰ì²˜ ì´ë¦„
                    "supplier_id": supplier_id  # ì¶”ì¶œëœ ê³µê¸‰ì²˜ ID (ì˜ˆ: ASIN, Walmart ID ë“±)
                }
```

**Step 3: Listing ê°ì²´ ìƒì„± ë° DB ì €ì¥** (ë¼ì¸ 2330-2394)
```2354:2378:backend/ebay_webhook.py
                    # Listing ê°ì²´ ìƒì„±
                    listing_obj = Listing(
                        ebay_item_id=listing_data["item_id"],
                        item_id=listing_data["item_id"],
                        title=listing_data["title"],
                        sku=listing_data.get("sku", ""),
                        image_url=listing_data.get("image_url") or listing_data.get("picture_url") or listing_data.get("thumbnail_url") or "",
                        price=listing_data.get("price", 0),
                        date_listed=date_listed,
                        sold_qty=listing_data.get("quantity_sold", 0),
                        watch_count=listing_data.get("watch_count", 0),
                        view_count=listing_data.get("view_count", 0),
                        impressions=listing_data.get("impressions", 0),
                        user_id=user_id,
                        supplier_name=listing_data.get("supplier_name"),
                        supplier_id=listing_data.get("supplier_id"),
                        source=listing_data.get("supplier_name", "Unknown"),
                        marketplace="eBay",
                        platform="eBay",
                        last_synced_at=datetime.utcnow()
                    )
                    listing_objects.append(listing_obj)
                
                # Upsert (ì¤‘ë³µ ì‹œ ì—…ë°ì´íŠ¸)
                if listing_objects:
                    upserted_count = upsert_listings(db, listing_objects)
```

### 1.2 Handleê³¼ SKU ìƒì„±/ì¶”ì¶œ ë¡œì§

#### SKU ì¶”ì¶œ
- **ìœ„ì¹˜**: `backend/ebay_webhook.py` ë¼ì¸ 2181
- **ë°©ì‹**: eBay XML ì‘ë‹µì—ì„œ `ebay:SKU` íƒœê·¸ ì§ì ‘ ì¶”ì¶œ
- **íŠ¹ì§•**: 
  - eBayì—ì„œ SKUê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë¹ˆ ë¬¸ìì—´(`""`) ë°˜í™˜
  - **ì „ì²˜ë¦¬ ë¡œì§ ì—†ìŒ** - eBayì—ì„œ ë°›ì€ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©

```2181:2181:backend/ebay_webhook.py
                # SKU
                sku = item.findtext("ebay:SKU", "", ns)
```

#### Handle ìƒì„±
- **ìœ„ì¹˜**: `backend/services.py` ë¼ì¸ 1924-1946
- **ê·œì¹™**: 
  1. `raw_data.handle` ì¡´ì¬ ì‹œ â†’ ì‚¬ìš©
  2. ì—†ìœ¼ë©´ â†’ `sku` ì‚¬ìš©

```1924:1946:backend/services.py
            # Try to get handle from raw_data or use SKU as fallback
            raw_data = listing.get("raw_data", {})
            if isinstance(raw_data, str):
                try:
                    raw_data = json.loads(raw_data)
                except:
                    raw_data = {}
            handle = (raw_data.get("handle") if raw_data else None) or sku
```

**âš ï¸ ë¬¸ì œì **:
1. **Handleì€ eBay APIì—ì„œ ì œê³µí•˜ì§€ ì•ŠìŒ** - `raw_data`ì— ì €ì¥ë˜ì§€ ì•Šìœ¼ë©´ SKUë¥¼ ëŒ€ì²´ë¡œ ì‚¬ìš©
2. **Shopify Handle í˜•ì‹ ê²€ì¦ ì—†ìŒ** - SKUê°€ Shopify Handle í˜•ì‹ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
3. **ì „ì²˜ë¦¬ ë¡œì§ ë¶€ì¬** - Shopify ì‚­ì œìš© Handle ë³€í™˜ ê·œì¹™ ì—†ìŒ

---

## 2. ğŸ” ìœ ì € ì‹ë³„ ë©”ì»¤ë‹ˆì¦˜ì˜ ì‹¤íƒœ

### 2.1 user_idë¥¼ Query íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

#### `backend/main.py` (6ê°œ)

1. **`GET /api/debug/listings`** (ë¼ì¸ 514-597)
   - `user_id: str = Query(..., description="User ID")` (í•„ìˆ˜)

2. **`GET /api/quote`** (ë¼ì¸ 988-1120)
   - `user_id: str = Query("default-user", description="User ID")` (ê¸°ë³¸ê°’ ìˆìŒ)

3. **`POST /api/low-performing/execute`** (ë¼ì¸ 1120-1292)
   - `user_id: str = Query("default-user", description="User ID")` (ê¸°ë³¸ê°’ ìˆìŒ)

4. **`POST /api/low-performing`** (ë¼ì¸ 1369-1469)
   - `user_id: str = Query("default-user", description="User ID")` (ê¸°ë³¸ê°’ ìˆìŒ)

5. **`GET /api/credits`** (ë¼ì¸ 2980-3154)
   - `user_id: str = Query("default-user", description="User ID")` (ê¸°ë³¸ê°’ ìˆìŒ)

6. **`POST /api/dev/credits/add`** (ë¼ì¸ 3142-3218)
   - `user_id: str = Query("default-user", description="User ID")` (ê¸°ë³¸ê°’ ìˆìŒ)

#### `backend/ebay_webhook.py` (7ê°œ)

1. **`GET /api/ebay/auth/start`** (ë¼ì¸ 455-521)
   - `user_id: str = Query(..., description="User ID to associate with eBay account")` (í•„ìˆ˜)

2. **`GET /api/ebay/auth/status`** (ë¼ì¸ 932-1027)
   - `user_id: str = Query(..., description="User ID to check")` (í•„ìˆ˜)

3. **`GET /api/ebay/auth/check`** (ë¼ì¸ 1065-1130)
   - `user_id: str = Query("default-user", description="User ID to check")` (ê¸°ë³¸ê°’ ìˆìŒ)

4. **`GET /api/ebay/listings`** (ë¼ì¸ 1266-1359)
   - `user_id: str = Query(..., description="User ID")` (í•„ìˆ˜)

5. **`POST /api/ebay/listings/sync`** (ë¼ì¸ 1361-1518)
   - `user_id: str = Query(..., description="User ID")` (í•„ìˆ˜)

6. **`GET /api/ebay/listings/trading`** (ë¼ì¸ 2027-2425)
   - `user_id: str = Query(..., description="User ID")` (í•„ìˆ˜)

7. **`GET /api/ebay/summary`** (ë¼ì¸ 2428-2562)
   - `user_id: str = Query(..., description="User ID")` (í•„ìˆ˜)

### 2.2 supabase.authì™€ì˜ ì—°ë™ ìƒíƒœ

**í˜„ì¬ ìƒíƒœ**: **ì™„ì „íˆ ë¶„ë¦¬ë¨** âŒ

**í™•ì¸ ì‚¬í•­**:
1. **í”„ë¡ íŠ¸ì—”ë“œ**: `useAuth()` í›… ì‚¬ìš© (`frontend/src/contexts/AuthContext.jsx`)
   - Supabase Auth ì‚¬ìš© ì—¬ë¶€ëŠ” ì½”ë“œì—ì„œ í™•ì¸ ë¶ˆê°€
   - `user?.id`ë¥¼ ê°€ì ¸ì™€ì„œ API íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬

2. **ë°±ì—”ë“œ**: 
   - **Supabase Auth ê²€ì¦ ì—†ìŒ**
   - **JWT í† í° ê²€ì¦ ì—†ìŒ**
   - **Session/Cookie ì¸ì¦ ì—†ìŒ**
   - ë‹¨ìˆœíˆ `user_id` ë¬¸ìì—´ì„ ë°›ì•„ì„œ ì‚¬ìš©

3. **ë³´ì•ˆ ì·¨ì•½ì **:
   - URLì— `user_id` ë…¸ì¶œ (ë¡œê·¸, ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬)
   - ë‹¤ë¥¸ ì‚¬ìš©ìì˜ `user_id`ë¥¼ ì¶”ì¸¡í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥
   - ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ë¶€ì¬ë¡œ ê¶Œí•œ ê²€ì¦ ë¶ˆê°€

**ê²°ë¡ **: `user_id`ëŠ” **ë…ë¦½ì ì¸ ë¬¸ìì—´**ë¡œ ì²˜ë¦¬ë˜ë©°, `supabase.auth`ì™€ **ì „í˜€ ì—°ë™ë˜ì§€ ì•ŠìŒ**

---

## 3. ğŸ“¦ Shopify ì¶”ì¶œ ë°ì´í„°ì˜ ì‹ ë¢°ì„±

### 3.1 generate_export_csv ì‹¤í–‰ ì‹œ ë°ì´í„° ì†ŒìŠ¤

**íŒŒì¼ ê²½ë¡œ**: `backend/services.py`

**í•¨ìˆ˜**: `generate_export_csv()` (ë¼ì¸ 1784-2004)

**ë°ì´í„° ì†ŒìŠ¤**: **DBì—ì„œ ì§ì ‘ ì¡°íšŒ** âœ…

```1820:1848:backend/services.py
    # Full Sync Mode: Export all active listings EXCEPT the provided list
    if mode == "full_sync_list" and db:
        # Get all active listings for this user/store
        query = db.query(Listing).filter(Listing.user_id == user_id)
        
        # Apply store filter if provided and not 'all'
        if store_id and store_id != 'all':
            if hasattr(Listing, 'store_id'):
                query = query.filter(Listing.store_id == store_id)
        
        all_listings = query.all()
        
        # Extract item IDs from the exclusion list (zombies to remove)
        exclusion_item_ids = set()
        for listing in listings:
            if isinstance(listing, dict):
                item_id = listing.get("item_id") or listing.get("ebay_item_id", "")
            else:
                item_id = listing.item_id if hasattr(listing, 'item_id') else (listing.ebay_item_id if hasattr(listing, 'ebay_item_id') else "")
            if item_id:
                exclusion_item_ids.add(item_id)
        
        # Filter out excluded items (survivors only)
        survivor_listings = [
            listing for listing in all_listings
            if listing.item_id not in exclusion_item_ids
        ]
        
        # Use survivors as the export list (no deletion logging for full sync mode)
        listings = survivor_listings
```

**ê²°ë¡ **: 
- **eBay API ì¬í˜¸ì¶œ ì—†ìŒ**
- **DBì˜ í˜„ì¬ ìƒíƒœë¥¼ ê·¸ëŒ€ë¡œ ë‚´ë³´ëƒ„**
- ë§ˆì§€ë§‰ ë™ê¸°í™” ì´í›„ ë³€ê²½ì‚¬í•­ì€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ

### 3.2 íŒë§¤ëŸ‰ ë° ì¬ê³  ìƒíƒœ ë°ì´í„° í¬í•¨ ì—¬ë¶€

**DB ìŠ¤í‚¤ë§ˆ í™•ì¸**: `backend/models.py` ë¼ì¸ 15-43

**í¬í•¨ëœ í•„ë“œ**:
- âœ… `sold_qty` (Integer): íŒë§¤ëŸ‰
- âœ… `watch_count` (Integer): ê´€ì‹¬ ìˆ˜
- âœ… `metrics` (JSONB): ìœ ì—°í•œ ë©”íŠ¸ë¦­ ë°ì´í„° ì €ì¥
  - `metrics['sales']`: íŒë§¤ëŸ‰
  - `metrics['views']`: ì¡°íšŒìˆ˜
  - `metrics['impressions']`: ë…¸ì¶œìˆ˜

**ì¬ê³  ìƒíƒœ**:
- âŒ **ì¬ê³  ìˆ˜ëŸ‰ í•„ë“œ ì—†ìŒ**
- eBay APIì—ì„œ `QuantityAvailable` ë°›ì§€ë§Œ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ
- ë™ê¸°í™” ì½”ë“œì—ì„œ `quantity_available` ì¶”ì¶œí•˜ì§€ë§Œ Listing ê°ì²´ì— í¬í•¨ë˜ì§€ ì•ŠìŒ

```2278:2278:backend/ebay_webhook.py
                    "quantity_available": quantity,
```

```2354:2373:backend/ebay_webhook.py
                    listing_obj = Listing(
                        ebay_item_id=listing_data["item_id"],
                        item_id=listing_data["item_id"],
                        title=listing_data["title"],
                        sku=listing_data.get("sku", ""),
                        ...
                        sold_qty=listing_data.get("quantity_sold", 0),
                        watch_count=listing_data.get("watch_count", 0),
                        # quantity_availableì€ ì €ì¥ë˜ì§€ ì•ŠìŒ âŒ
```

**ë¬¸ì œì **: 
- ì¬ê³ ê°€ 0ì¸ ì•„ì´í…œì„ í•„í„°ë§í•  ìˆ˜ ì—†ìŒ
- Shopify ì‚­ì œ ì‹œ "í’ˆì ˆ" ìƒíƒœë¥¼ ê³ ë ¤í•  ìˆ˜ ì—†ìŒ

---

## 4. ğŸ’³ í¬ë ˆë”§ ë° íŠ¸ëœì­ì…˜ ì•ˆì „ì„±

### 4.1 í¬ë ˆë”§ ì°¨ê°ê³¼ ë°ì´í„° ì €ì¥ ì‚¬ì´ì˜ íŠ¸ëœì­ì…˜ ê´€ê³„

**íŒŒì¼ ê²½ë¡œ**: `backend/main.py`

**í•¨ìˆ˜**: `execute_low_performing_analysis()` (ë¼ì¸ 1120-1292)

**íŠ¸ëœì­ì…˜ íë¦„ ë¶„ì„**:

**Step 1: í¬ë ˆë”§ ì°¨ê°** (ë¼ì¸ 1246-1270)
```1246:1270:backend/main.py
    # í¬ë ˆë”§ ì²´í¬ ë° atomic ì°¨ê°
    try:
        credit_result = deduct_credits_atomic(
            db=db,
            user_id=user_id,
            amount=required_credits,
            description=f"Low-Performing SKUs analysis (filters: {filters}, candidates: {estimated_candidates})",
            reference_id=idempotency_key
        )
        
        if not credit_result.success:
            # í¬ë ˆë”§ ë¶€ì¡±
            remaining = get_available_credits(db, user_id)
            logger.warning(f"âš ï¸ [{idempotency_key}] í¬ë ˆë”§ ë¶€ì¡±: available={remaining}, required={required_credits}")
            raise HTTPException(
                status_code=http_status.HTTP_402_PAYMENT_REQUIRED,
                ...
            )
```

**Step 2: ë¶„ì„ ìˆ˜í–‰** (ë¼ì¸ 1270 ì´í›„)
- í¬ë ˆë”§ ì°¨ê° ì„±ê³µ í›„ ë¶„ì„ ë¡œì§ ì‹¤í–‰
- **ë³„ë„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰**

**ìœ„í—˜ ì‹œë‚˜ë¦¬ì˜¤**:
1. âœ… **í¬ë ˆë”§ ì°¨ê° ì„±ê³µ** â†’ `deduct_credits_atomic()`ì—ì„œ DB commit
2. âŒ **ë¶„ì„ ë¡œì§ ì‹¤í–‰ ì¤‘ ì—ëŸ¬ ë°œìƒ**
3. âŒ **í¬ë ˆë”§ì€ ì´ë¯¸ ì°¨ê°ë¨** (ì»¤ë°‹ ì™„ë£Œ)
4. âŒ **ë¶„ì„ ê²°ê³¼ëŠ” ì—†ìŒ**

**í˜„ì¬ í™˜ë¶ˆ ë¡œì§**:
- `deduct_credits_atomic()` ë‚´ë¶€ì—ì„œë§Œ ì›ìì  ì²˜ë¦¬
- ë¶„ì„ ì‹¤íŒ¨ ì‹œ **ìë™ í™˜ë¶ˆ ë¡œì§ ì—†ìŒ**

**ê²°ë¡ **: **ë°ì´í„° ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„± ì¡´ì¬** âš ï¸

---

### 4.2 eBay ë™ê¸°í™”ì™€ í¬ë ˆë”§ì˜ ê´€ê³„

**í™•ì¸ ê²°ê³¼**: eBay ë™ê¸°í™”(`sync_ebay_listings`)ëŠ” **í¬ë ˆë”§ ì°¨ê° ì—†ìŒ** âœ…

- ë™ê¸°í™” ìì²´ëŠ” ë¬´ë£Œ
- í¬ë ˆë”§ì€ "ë¶„ì„" ì‘ì—…ì—ë§Œ ì‚¬ìš©

---

## 5. ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ë° API ì„¤ì •

### 5.1 eBay API ì„¤ì • ê´€ë¦¬ ë°©ì‹

**íŒŒì¼ ê²½ë¡œ**: `backend/workers/ebay_token_worker.py`

**í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©** âœ…:
```51:56:backend/workers/ebay_token_worker.py
# í™˜ê²½ë³€ìˆ˜
DATABASE_URL = os.getenv("DATABASE_URL", "")
EBAY_CLIENT_ID = os.getenv("EBAY_CLIENT_ID", "")
EBAY_CLIENT_SECRET = os.getenv("EBAY_CLIENT_SECRET", "")
EBAY_ENVIRONMENT = os.getenv("EBAY_ENVIRONMENT", "PRODUCTION")  # SANDBOX or PRODUCTION
SENTRY_DSN = os.getenv("SENTRY_DSN", "")
```

**ë™ì  ë¡œë“œ** (ë¼ì¸ 182-183):
```182:183:backend/workers/ebay_token_worker.py
    # ë™ì ìœ¼ë¡œ í™˜ê²½ë³€ìˆ˜ ë¡œë“œ (Railway ë³€ê²½ ë°˜ì˜)
    client_id = os.getenv("EBAY_CLIENT_ID", EBAY_CLIENT_ID)
    client_secret = os.getenv("EBAY_CLIENT_SECRET", EBAY_CLIENT_SECRET)
```

**eBay API ì—”ë“œí¬ì¸íŠ¸** (ë¼ì¸ 38-45):
```38:45:backend/ebay_webhook.py
# eBay API Endpoints
EBAY_API_ENDPOINTS = {
    "SANDBOX": {
        "trading": "https://api.sandbox.ebay.com/ws/api.dll",
        "oauth": "https://api.sandbox.ebay.com/identity/v1/oauth2/token"
    },
    "PRODUCTION": {
        "trading": "https://api.ebay.com/ws/api.dll",
        "oauth": "https://api.ebay.com/identity/v1/oauth2/token"
    }
}
```

**ê²°ë¡ **: 
- âœ… **í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬ë¨** (`EBAY_CLIENT_ID`, `EBAY_CLIENT_SECRET`)
- âœ… **í•˜ë“œì½”ë”© ì—†ìŒ**
- âš ï¸ API ì—”ë“œí¬ì¸íŠ¸ URLì€ ì½”ë“œì— ìƒìˆ˜ë¡œ ì •ì˜ (í™˜ê²½ë³€ìˆ˜ ì•„ë‹˜)

---

## ğŸš¨ ê°€ì¥ ìœ„í—˜í•œ ë¶€ë¶„ Top 3 (ìš°ì„ ìˆœìœ„ ìˆœ)

### ğŸ¥‡ **1ìˆœìœ„: ì¸ì¦ ì‹œìŠ¤í…œ ë¶€ì¬ - ë³´ì•ˆ ì·¨ì•½ì  (Critical)**

**ë¬¸ì œ**:
- `user_id`ë¥¼ Query íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
- ë°±ì—”ë“œì—ì„œ ì¸ì¦ ê²€ì¦ ì—†ìŒ
- ë‹¤ë¥¸ ì‚¬ìš©ìì˜ `user_id`ë¥¼ ì¶”ì¸¡í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥

**ì˜í–¥**:
- **ë°ì´í„° ìœ ì¶œ**: ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë¦¬ìŠ¤íŒ… ì¡°íšŒ ê°€ëŠ¥
- **í¬ë ˆë”§ íƒˆì·¨**: ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í¬ë ˆë”§ ì‚¬ìš© ê°€ëŠ¥
- **eBay ê³„ì • íƒˆì·¨**: ë‹¤ë¥¸ ì‚¬ìš©ìì˜ eBay ê³„ì • ì—°ë™ ê°€ëŠ¥

**ë°œìƒ ìœ„ì¹˜**:
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ (13ê°œ)

**í•´ê²° í•„ìš”ì„±**: âš ï¸ **ì¦‰ì‹œ í•´ê²° í•„ìš”**

---

### ğŸ¥ˆ **2ìˆœìœ„: í¬ë ˆë”§ ì°¨ê°ê³¼ ë°ì´í„° ì €ì¥ì˜ íŠ¸ëœì­ì…˜ ë¶„ë¦¬ (High)**

**ë¬¸ì œ**:
- í¬ë ˆë”§ ì°¨ê°ê³¼ ë¶„ì„ ì‘ì—…ì´ **ë³„ë„ íŠ¸ëœì­ì…˜**ìœ¼ë¡œ ì‹¤í–‰
- í¬ë ˆë”§ ì°¨ê° ì„±ê³µ â†’ ë¶„ì„ ì‹¤íŒ¨ ì‹œ **í™˜ë¶ˆ ì—†ìŒ**

**ì˜í–¥**:
- ì‚¬ìš©ì í¬ë ˆë”§ ì†ì‹¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìœ„ë°˜ (ì‘ì—… ì‹¤íŒ¨ ì‹œ í¬ë ˆë”§ ì°¨ê° ê¸ˆì§€)

**ë°œìƒ ìœ„ì¹˜**:
- `backend/main.py`: `execute_low_performing_analysis()` (ë¼ì¸ 1120-1292)

**ì‹œë‚˜ë¦¬ì˜¤**:
1. ì‚¬ìš©ìê°€ 100 í¬ë ˆë”§ìœ¼ë¡œ ë¶„ì„ ìš”ì²­
2. í¬ë ˆë”§ ì°¨ê° ì„±ê³µ (DB commit)
3. ë¶„ì„ ë¡œì§ ì‹¤í–‰ ì¤‘ ì„œë²„ ì˜¤ë¥˜
4. í¬ë ˆë”§ 100 ê°ì†Œ, ë¶„ì„ ê²°ê³¼ ì—†ìŒ

**í•´ê²° í•„ìš”ì„±**: âš ï¸ **ë†’ìŒ** (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìœ„ë°˜)

---

### ğŸ¥‰ **3ìˆœìœ„: Handle ìƒì„± ë¡œì§ì˜ ì‹ ë¢°ì„± ë¶€ì¡± (Medium)**

**ë¬¸ì œ**:
- Shopify Handleì´ eBay APIì—ì„œ ì œê³µë˜ì§€ ì•ŠìŒ
- SKUë¥¼ Handle ëŒ€ì²´ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ í˜•ì‹ ê²€ì¦ ì—†ìŒ
- Shopify ì‚­ì œ ì‘ì—… ì‹¤íŒ¨ ê°€ëŠ¥

**ì˜í–¥**:
- Shopify CSV ë‚´ë³´ë‚´ê¸° ì‹œ Handle ë¶ˆì¼ì¹˜ë¡œ ì‚­ì œ ì‹¤íŒ¨
- ë“œëì‰¬í¼ì˜ ì‘ì—… íš¨ìœ¨ ì €í•˜

**ë°œìƒ ìœ„ì¹˜**:
- `backend/services.py`: `generate_export_csv()` (ë¼ì¸ 1924-1946)

**ë¬¸ì œ ì½”ë“œ**:
```1924:1946:backend/services.py
            # Try to get handle from raw_data or use SKU as fallback
            raw_data = listing.get("raw_data", {})
            if isinstance(raw_data, str):
                try:
                    raw_data = json.loads(raw_data)
                except:
                    raw_data = {}
            handle = (raw_data.get("handle") if raw_data else None) or sku
```

**í•´ê²° í•„ìš”ì„±**: âš ï¸ **ì¤‘ê°„** (ê¸°ëŠ¥ ì‹ ë¢°ì„± ë¬¸ì œ)

---

## ğŸ“ ì¶”ê°€ ë°œê²¬ ì‚¬í•­

### ì¬ê³  ìƒíƒœ ë°ì´í„° ëˆ„ë½
- eBay APIì—ì„œ `QuantityAvailable` ì¶”ì¶œí•˜ì§€ë§Œ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ
- í’ˆì ˆ ì•„ì´í…œ í•„í„°ë§ ë¶ˆê°€

### Supabase Auth ì—°ë™ ë¶€ì¬
- í”„ë¡ íŠ¸ì—”ë“œëŠ” `useAuth()` ì‚¬ìš©í•˜ì§€ë§Œ ë°±ì—”ë“œì™€ ì—°ë™ ì—†ìŒ
- ë…ë¦½ì ì¸ ë¬¸ìì—´ë¡œ ì²˜ë¦¬

---

**ë¶„ì„ ì™„ë£Œì¼**: 2025-01-XX  
**ë¶„ì„ ëŒ€ìƒ íŒŒì¼**: 
- `backend/main.py`
- `backend/ebay_webhook.py`
- `backend/services.py`
- `backend/models.py`
- `backend/credit_service.py`

